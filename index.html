<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Mídia Indoor</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }

    /* Player ocupa a tela toda */
    #player {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      background: black;
    }

    /* Vídeo e imagens sempre em tela cheia */
    #player video,
    #player img {
      width: 100%;
      height: 100%;
      object-fit: cover; /* agora preenche a tela toda */
    }

    /* Faixa inferior com degradê mais discreto */
    #infos {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 12vh; /* faixa menor */
      padding: 10px 20px;
      box-sizing: border-box;
      background: linear-gradient(to top, rgba(0,0,0,0.85), rgba(0,0,0,0));
      font-size: 18px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      color: white;
    }

    /* Texto das notícias com animação */
    #news {
      margin-top: 5px;
      white-space: nowrap;
      overflow: hidden;
      box-sizing: border-box;
    }
    #news span {
      display: inline-block;
      padding-left: 100%;
      animation: marquee 25s linear infinite; /* ajustei a velocidade */
    }
    @keyframes marquee {
      from { transform: translateX(0%); }
      to { transform: translateX(-100%); }
    }
  </style>
</head>
<body>

  <div id="player"></div>

  <div id="infos">
    <div id="hora">Hora: --:--:--</div>
    <div id="tempo">Tempo: carregando...</div>
    <div id="megasena">Mega-Sena: carregando...</div>
    <div id="news"><span>Carregando notícias...</span></div>
  </div>

  <script>
    // -------------------------------
    // 1) Playlist de Anúncios
    // -------------------------------
    let playlist = [];
    let current = 0;

    async function loadPlaylist() {
      try {
        const res = await fetch("playlist.json");
        playlist = await res.json();
        playNext();
      } catch (e) {
        console.error("Erro carregando playlist", e);
      }
    }

    function playNext() {
      if (!playlist.length) return;

      const item = playlist[current];
      const player = document.getElementById("player");
      player.innerHTML = "";

      if (item.type === "video") {
        const video = document.createElement("video");
        video.src = item.src;
        video.autoplay = true;
        video.controls = false;
        video.muted = true;
        video.onended = () => {
          current = (current + 1) % playlist.length;
          playNext();
        };
        player.appendChild(video);

      } else if (item.type === "image") {
        const img = document.createElement("img");
        img.src = item.src;
        player.appendChild(img);
        setTimeout(() => {
          current = (current + 1) % playlist.length;
          playNext();
        }, (item.duration || 10) * 1000);
      }
    }

    loadPlaylist();

    // -------------------------------
    // 2) Relógio em tempo real
    // -------------------------------
    setInterval(() => {
      const agora = new Date();
      document.getElementById("hora").innerText =
        "Hora: " + agora.toLocaleTimeString();
    }, 1000);

    // -------------------------------
    // 3) Previsão do tempo
    // -------------------------------
    fetch("https://api.openweathermap.org/data/2.5/weather?lat=-21.7622&lon=-41.31819&units=metric&lang=pt_br&appid=c7296395a29b7135070ba6fd3c342cd0")
      .then(r => r.json())
      .then(dados => {
        document.getElementById("tempo").innerText =
          `Tempo: ${dados.weather[0].description}, ${dados.main.temp}°C`;
      })
      .catch(() => {
        document.getElementById("tempo").innerText = "Tempo: não disponível";
      });

    // -------------------------------
    // 4) Mega-Sena
    // -------------------------------
    fetch("https://loteriascaixa-api.herokuapp.com/api/megasena/latest")
      .then(r => r.json())
      .then(dados => {
        document.getElementById("megasena").innerText =
          "Mega-Sena último sorteio: " + dados.dezenas.join(", ");
      })
      .catch(() => {
        document.getElementById("megasena").innerText = "Mega-Sena: não disponível";
      });

    // -------------------------------
    // 5) Notícias (RSS)
    // -------------------------------
    async function carregarNoticias() {
      try {
        const urls = [
          "https://api.rss2json.com/v1/api.json?rss_url=https://g1.globo.com/rss/g1/rj/norte-fluminense/",
          "https://api.rss2json.com/v1/api.json?rss_url=https://g1.globo.com/rss/g1/rio-de-janeiro/"
        ];

        let manchetes = [];

        for (let url of urls) {
          const r = await fetch(url);
          const dados = await r.json();
          manchetes.push(...dados.items
            .filter(n => n.title.includes("Campos dos Goytacazes") || n.title.includes("Campos"))
            .slice(0, 3)
            .map(n => n.title)
          );
        }

        if (manchetes.length === 0) {
          manchetes.push("Nenhuma notícia recente de Campos dos Goytacazes.");
        }

        document.getElementById("news").innerHTML =
          "<span>" + manchetes.join(" • ") + "</span>";
      } catch (e) {
        document.getElementById("news").innerHTML =
          "<span>Erro ao carregar notícias</span>";
      }
    }

    carregarNoticias();
    setInterval(carregarNoticias, 10 * 60 * 1000);
  </script>

</body>
</html>
